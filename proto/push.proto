syntax = "proto3";

package flare.push.v1;

import "common/errors.proto";
import "common/metadata.proto";

// 推送服务
service PushService {
  // 推送消息
  rpc PushMessage(PushMessageRequest) returns (PushMessageResponse);
  
  // 推送通知
  rpc PushNotification(PushNotificationRequest) returns (PushNotificationResponse);
}

// 推送消息请求
message PushMessageRequest {
  repeated string user_ids = 1;
  bytes message = 2;
  PushOptions options = 3;
  flare.common.v1.RequestContext context = 4;
  flare.common.v1.TenantContext tenant = 5;
}

// 推送消息响应
message PushMessageResponse {
  int32 success_count = 1;
  int32 fail_count = 2;
  repeated string failed_user_ids = 3;
  repeated PushFailure failures = 4;
  flare.common.v1.RpcStatus status = 5;
}

// 推送通知请求
message PushNotificationRequest {
  repeated string user_ids = 1;
  Notification notification = 2;
  PushOptions options = 3;
  flare.common.v1.RequestContext context = 4;
  flare.common.v1.TenantContext tenant = 5;
}

// 推送通知响应
message PushNotificationResponse {
  int32 success_count = 1;
  int32 fail_count = 2;
  repeated PushFailure failures = 3;
  flare.common.v1.RpcStatus status = 4;
}

// 推送选项
message PushOptions {
  bool require_online = 1;
  bool persist_if_offline = 2;
  int32 priority = 3;
  map<string, string> metadata = 4;
}

// 通知
message Notification {
  string title = 1;
  string body = 2;
  map<string, string> data = 3;
  map<string, string> metadata = 4;
}

message PushFailure {
  string user_id = 1;
  flare.common.v1.ErrorCode code = 2;
  string error_message = 3;
}

